# 🎱 Hybrid Sniper V5: 자율 진화형 무인 로또 분석 기지

> **"Apple Silicon (M5) 환경에 최적화된, 스스로 생각하고 휴식하는 완전 무인 AI 요새"**

**Sniper V5**는 단순한 자동화 스크립트가 아닙니다.
**Gemini 2.5 Flash**를 지휘관으로 하는 이 시스템은 스스로 자신의 상태를 진단하고, 하드웨어 부하를 감지하여 생존하며, 과거의 실패로부터 더 나은 질문(Prompt)을 찾아내는 **살아있는 유기체**처럼 작동합니다.

---

## 🏛️ 프로젝트 개요 (Overview)

이 시스템은 **한국 표준시(KST) 매일 새벽 02:00**에 깨어나, 일요일을 시작으로 하는 주간 작전 사이클을 수행합니다.
서버 상태나 네트워크 문제로 작전이 중단되더라도, 다음 날 깨어났을 때 `sniper_state.json`을 통해 **끊긴 지점부터 즉시 이어하기(Smart Catch-up)**를 수행합니다.

- **메인 지휘관 (Commander):** `gemini-2.5-flash` (고정)
- **실행 환경:** Apple Silicon M5 (Neural Engine 가속 활용)
- **핵심 철학:** **무중단 수행** (Resilience) & **자율 진화** (Self-Evolution)

---

## 🔄 지능형 순환 파이프라인 (Intelligent Pipeline)

시스템은 매일 **KST 02:00**에 가동되며, 고정된 요일 스케줄보다 **'현재 상태'**를 우선시하는 4단계 흐름을 따릅니다.

### 1단계: 상태 진단 (State Diagnosis)
기지가 깨어나면 가장 먼저 `sniper_state.json`을 판독합니다.
- *"지난 작전이 성공했는가?"*
- *"어제 수행하지 못한(누락된) 단계가 있는가?"*

### 2단계: 스마트 캐치업 (Smart Catch-up)
만약 네트워크 오류나 시스템 과부하로 인해 밀린 작전이 있다면, 오늘의 정규 작전보다 **과거의 미완성 임무를 최우선으로 처리**하여 데이터의 연속성을 보장합니다.

### 3단계: 유기적 작전 흐름 (Organic Workflow)
모든 상태가 정상이라면, 일요일을 기점으로 다음 순서대로 작전을 수행합니다.

| 작전명 | 실행 요일 (권장) | 임무 내용 |
| :--- | :--- | :--- |
| **기초 공사** | **일요일** | **데이터 수집** (Naver/Gemini 파싱) ➡️ **AI 학습** (M5 가속, 가중치 저장) |
| **실전 사격** | **월요일** | **정예 번호 예측** (Top 20 + LLM 선별) ➡️ **성과 평가** (적중률 계산) |
| **자가 진화** | **화요일** | **메타 프롬프팅** (성과 분석 후 프롬프트 스스로 수정 및 버전 업) |

### 4단계: 생존 본능 - 절대 안전 모드 (Survival Mode)
작전 수행 중 M5 칩의 **CPU 점유율이 60%를 초과**하거나 메모리가 부족할 경우:
1. 즉시 모든 작업을 중단합니다.
2. *"하드웨어 보호를 위해 작전 이월"* 로그를 남깁니다.
3. 남은 임무는 **다음 날 02:00로 자동 예약**되고, 시스템은 즉시 **잠자기 모드**로 대피합니다.

---

## 🧬 Sniper V5만의 핵심 지능 (Key Features)

### 🧠 1. 메타 프롬프팅 (Meta-Prompting Evolution)
단순히 번호만 예측하는 것이 아닙니다. AI는 자신의 지난주 예측 성적표를 분석합니다.
- *"왜 틀렸지?"*를 스스로 자문하며, 다음 예측에 사용할 **'전략 프롬프트'를 스스로 수정(Rewrite)**합니다.
- 예: `v1.0 (기본)` ➡️ `v1.1 (분산 투자 강조)` ➡️ `v1.2 (이월수 패턴 집중)`

### 🛡️ 2. 하드웨어 보호 및 자동 휴식 (Auto-Sleep)
- **메모리 정화:** 매 단계가 끝날 때마다 `torch.mps.empty_cache()`를 실행하여 M5 Neural Engine을 초기화합니다.
- **자동 퇴근:** 모든 작전(또는 이월 예약)이 끝나면 **30초 카운트다운** 후 맥북을 강제로 **잠자기 모드(Sleep)**로 전환하여 하드웨어 수명을 보호합니다.

### 📝 3. 구글 시트 '작전로그' (Live Operation Log)
`로또 max` 스프레드시트의 **'작전로그'** 탭에 모든 상황이 실시간으로 기록됩니다.
- **성공:** ✅ (Phase 1 완료)
- **실패:** ❌ (네트워크 에러, 재시도 예약됨)
- **보류:** 💤 (CPU 과부하로 인한 작전 이월)
- **진화:** 🧬 (프롬프트 버전 v1.2로 업데이트됨)

---

## 🚀 설치 및 실행 가이드 (How to Run)

### 1. 환경 설정 (Dependencies)
터미널에서 아래 명령어로 필수 라이브러리를 한 번에 설치합니다.
```bash
pip install pytz psutil gspread oauth2client pandas google-genai python-dotenv torch schedule
```

### 2. 필수 파일 준비
프로젝트 폴더에 다음 파일들이 있는지 확인하세요.
- `.env`: `GEMINI_API_KEY` 포함
- `creds_lotto.json`: 구글 서비스 계정 인증 키

### 3. 시스템 가동 (Deploy)
백그라운드 스케줄러를 실행합니다. 이제 터미널을 켜두기만 하면 알아서 작동하고 잠듭니다.
```bash
python main_scheduler.py
```

---

## ⚠️ 사령관님을 위한 보안 수칙
- **API 키 관리:** `.env` 파일은 절대 외부에 노출하지 마십시오.
- **인증:** 로컬에서는 `creds_lotto.json`을, GitHub Actions에서는 `GOOGLE_CREDS_JSON` 환경 변수를 우선 사용합니다 (하이브리드 인증).
- **시스템 간섭:** 스케줄러가 작동 중일 때는 맥북의 전원을 끄지 마십시오. (작전 후 알아서 잠듭니다.)

---
**Mission Status: ACTIVE**
**Commander Model: gemini-2.5-flash**
