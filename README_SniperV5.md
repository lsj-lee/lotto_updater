# 🎱 Hybrid Sniper V5: 자율 진화형 로또 분석 시스템

**Hybrid Sniper V5**는 네이버 검색 결과 파싱, LSTM 딥러닝 분석, 통계적 필터링, 그리고 LLM(Gemini)의 최종 판단을 결합한 4단계 하이브리드 로또 예측 시스템입니다.
Apple Silicon (M5) 환경에 최적화되어 있으며, 한국 표준시(KST)를 기준으로 모든 작업이 자동화되어 있습니다.

---

## 🏛️ 시스템 아키텍처 (4-Phase Architecture)

이 프로젝트는 각 역할이 완벽히 분리된 4개의 독립적인 Phase로 구성됩니다.

### 🔄 Phase 1: 데이터 동기화 (Data Sync)
- **실행 시간:** 매주 **일요일 02:00 (KST)**
- **역할:** 최신 로또 당첨 결과를 네이버에서 검색하고, **Gemini AI**를 통해 비정형 텍스트를 파싱하여 구글 시트에 자동 저장합니다.
- **특징:** 공식 API가 없어도 AI가 사람처럼 검색 결과를 읽고 처리합니다.

### 🧠 Phase 2: 특징 학습 (Feature Learning)
- **실행 시간:** 매주 **월요일 02:00 (KST)**
- **역할:** 과거 데이터를 바탕으로 **LSTM 신경망**을 학습시킵니다.
- **핵심:** 학습된 결과는 예측에 바로 쓰이지 않고, **가중치 파일(`hybrid_sniper_v5_state.pth`)** 형태로만 저장됩니다.
- **최적화:** M5 Neural Engine(MPS)을 사용하여 고속 연산을 수행합니다.

### 🔮 Phase 3: 하이브리드 예측 (Hybrid Strategy) 🔥
- **실행 시간:** 매주 **수요일 02:00 (KST)**
- **역할:** 저장된 '두뇌(가중치)'를 깨워 실전 예측을 수행합니다.
- **4단계 프로세스:**
  1. **Top 20 압축:** AI 모델이 확률이 가장 높은 상위 20개 번호를 선정.
  2. **1만 개 시뮬레이션:** Top 20 번호 내에서 10,000개의 무작위 조합 생성.
  3. **통계적 필터링:** 합계(100~170), 홀짝(2:4~4:2) 규칙으로 50개 후보 압축.
  4. **LLM 최종 선별:** Gemini에게 50개 중 가장 유망한 5~10개를 고르도록 요청.

### 🧬 Phase 4: 자율 진화 및 평가 (Orchestration)
- **실행 시간:**
  - **목요일 02:00 (KST):** 지난주 예측 성과(당첨 여부)를 평가하고 로그를 남깁니다.
  - **금요일 02:00 (KST):** AI가 스스로 코드를 분석하고 개선점을 제안합니다. (사용자 승인 필요)

---

## 🚀 시작 가이드 (Getting Started)

### 1. 환경 설정
필요한 라이브러리를 설치합니다.
```bash
pip install -r requirements.txt
```

### 2. 설정 파일 준비
- `.env` 파일에 `GEMINI_API_KEY`를 입력하세요.
- `creds_lotto.json` (구글 서비스 계정 키)를 프로젝트 폴더에 넣으세요.

### 3. 스케줄러 실행 (권장)
백그라운드에서 모든 작업을 자동으로 수행하려면 아래 명령어를 실행하세요.
```bash
python main_scheduler.py
```
> **참고:** 터미널을 끄면 스케줄러도 종료됩니다. `nohup` 등을 사용하거나 화면 켜짐을 유지하세요.

### 4. 수동 실행 (테스트)
각 단계를 즉시 테스트하고 싶다면 아래처럼 실행하세요.
```bash
python lotto_predict.py
```

---

## ⚠️ 안전 및 최적화 (Safety & Optimization)

- **M5 가속:** `torch.device('mps')`를 사용하여 Apple Silicon의 성능을 극대화합니다.
- **발열 관리:** 학습 시 코어 수를 6개로 제한하고, 주기적으로 메모리(`gc.collect`)를 정리하여 시스템 과부하를 막습니다.
- **KST 준수:** 서버의 시간대가 어디든 상관없이 무조건 **한국 시간(Asia/Seoul)**을 기준으로 작동합니다.

---

## 📜 라이선스 및 면책 조항
이 프로젝트는 연구 및 학습 목적으로 개발되었습니다. 로또 당첨을 보장하지 않으며, AI의 예측 결과는 재미로만 참고하시기 바랍니다.
